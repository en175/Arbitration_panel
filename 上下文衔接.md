# 仲裁组庭 Demo 项目上下文衔接文档 (Context Handover)

> **适用场景**：开启新对话时，请让 AI 助手按顺序阅读并理解以下 3 份文档，再开始生成/回答，确保业务规则与产出一致：
> 1) `上下文衔接.md`（本文件）
> 2) `需求文档/第四章-仲裁庭.md`（规则依据与期限口径）
> 3) `需求文档/新版仲裁组庭-PRD.md`（产品定义与流程节点）

**对话约定**
- AI 每次回答的第一句话必须称呼我为 **Yela**（用于校验是否脱离上下文）。
- AI 需要通过多提问来理解需求；每次对话在动手开发/改代码前，必须先向我确认方案范围，且只有在我明确下达“可以开干/开始改/动手”等指令后才开始执行。

## 1. 项目概况
- **项目名称**：广州仲裁委·新版仲裁组庭
- **目标**：构建一个符合真实业务逻辑、具备“权威信赖风”UI 的仲裁组庭工作台演示原型。
- **技术栈**：Vue 3 + Vite（当前已集成 Element Plus，但组件选型不受其风格束缚）

## 2. 核心架构与设计

### 2.1 UI 设计风格
- **主题**：权威信赖风 (Authority & Trust)。
- **主色调**：
  - Primary (深蓝): `#1E3A8A` (用于顶栏、主按钮)
  - Accent (金色): `#B45309` (用于高亮、重要标签)
- **字体**：标题使用衬线体 (EB Garamond/Songti)，正文使用无衬线体。
- **布局**：
  1. **Top Bar**: 品牌标识 + 案件信息（案号 | 案由 | 标的额）。
  2. **Timeline**: 顶部固定横向滚动时间轴，展示当前启用的流程节点（可插入/隐藏节点）。
  3. **Workspace**: 下方动态加载对应节点的业务组件。

### 2.2 数据与状态管理
- **文件**：`src/views/workbench/composables/useArbitration.js`
- **机制**：
  - `activeNodeId`: 当前查看的节点 ID（控制下方 Workspace 显示）。
  - `timelineNodes`: 时间轴节点数据源（当前演示版启用 11 个节点），每个节点包含状态 (`completed`, `in_progress`, `pending`) 和业务数据。
  - **全能视角**：不设登录页，用户通过点击时间轴节点即可查看不同角色的操作视图（如秘书核对、主任审批、当事人选定）。

> 角色切换：`switchRole(role)` 目前支持 `party / secretary / director / arbitrator / dept_head`。

### 2.3 组件与依赖选型
- **组件库/依赖**：可以优先引入合适的新库实现更好的体验与视觉效果，不受 Element Plus 的风格束缚。
- **约束**：引入前先确认项目内是否已有同类能力，避免重复引库；引入后确保 `npm run dev` 可正常运行与预览。

## 3. 已实现功能模块 (Nodes)

组件位于 `src/views/workbench/nodes/`，当前项目里这些节点组件均已存在：

| 组件名 | 业务功能（组件语义） | 备注 |
| :--- | :--- | :--- |
| `NodeStart.vue` | 组庭启动 | 已接入工作台 |
| `NodeNominate.vue` | 边裁选择/选定结果提交展示（演示口径） | 已接入工作台 |
| `NodeSelection.vue` | 首席仲裁员选择方式（共同选定/委托主任指定） | 已接入工作台 |
| `NodeDisclosure.vue` | 披露与接受（仲裁员端演示） | 工作台已预留映射；当前时间轴未启用 |
| `NodeCheck.vue` | 材料核对（秘书端演示） | 工作台已预留映射；当前时间轴未启用 |
| `NodeReview.vue` | 立案部长审核（审批链演示） | 已接入工作台（当前用作 Node ID=6） |
| `NodeReviewLeadership.vue` | 分管委领导审核（审批链演示） | 已接入工作台（当前用作 Node ID=6.5） |
| `NodeDirector.vue` | 主任选择指定路径 | 已接入工作台（当前用作 Node ID=7） |
| `NodeDistribute.vue` | 主任生成并发送名单 | 已接入工作台（当前用作 Node ID=8） |
| `NodeRanking.vue` | 当事人对推荐名单排序 | 已接入工作台（当前用作 Node ID=9） |
| `NodeResult.vue` | 系统汇总排序结果（中间态） | 已接入工作台（当前用作 Node ID=10） |
| `NodeDirectorDesignate.vue` | 主任最终指定（兜底/冲突处理） | 已接入工作台（当前用作 Node ID=11） |
| `NodeFinish.vue` | 组庭完成 | 已接入工作台（当前用作 Node ID=12） |
| `NodeConfirm.vue` | 人选确认（历史版本组件） | 当前未在工作台映射中使用 |

### 3.1 当前时间轴启用的节点（以代码为准）

时间轴的数据源在 `src/views/workbench/composables/useArbitration.js` 的 `timelineNodes`。注意：
- 时间轴的显示顺序以 `timelineNodes` 数组顺序为准（并非按 `id` 排序）。
- `id` 不要求连续；当前有 `6.5` 这样的“插入节点”用于审批链拆分。
- 组件渲染映射在 `src/views/workbench/ArbitrationWorkbench.vue` 的 `currentNodeComponent`。

| 时间轴顺序 | Node ID | 节点标题（timeLineNodes.title） | 角色（roleLabel） | 工作台渲染组件 |
| :---: | :---: | :--- | :--- | :--- |
| 1 | 1 | 组庭启动 | 秘书 | `NodeStart.vue` |
| 2 | 2 | 边裁选择 | 当事人 | `NodeNominate.vue` |
| 3 | 3 | 首席选择 | 当事人 | `NodeSelection.vue` |
| 4 | 6 | 立案部长审核 | 立案部长 | `NodeReview.vue` |
| 5 | 6.5 | 分管委领导 | 分管委领导 | `NodeReviewLeadership.vue` |
| 6 | 7 | 主任选择指定路径 | 主任 | `NodeDirector.vue` |
| 7 | 8 | 主任生成并发送名单 | 主任 | `NodeDistribute.vue` |
| 8 | 9 | 当事人排序共同选定 | 当事人 | `NodeRanking.vue` |
| 9 | 10 | 系统汇总排序结果 | 系统 | `NodeResult.vue` |
| 10 | 11 | 主任最终指定 | 主任 | `NodeDirectorDesignate.vue` |
| 11 | 12 | 组庭完成 | 秘书 | `NodeFinish.vue` |

> 说明：`NodeDisclosure.vue`（披露与接受）与 `NodeCheck.vue`（材料核对）组件仍保留在代码中，工作台也预留了 `id=4/5` 的渲染映射，但当前 `timelineNodes` 未启用这两个节点。

## 4. 关键文件索引
- **入口页面**: `src/views/workbench/ArbitrationWorkbench.vue` (布局容器，负责调度 Timeline 和 Node 组件)
- **时间轴组件**: `src/views/workbench/components/HorizontalTimeline.vue`
- **全局样式**: `src/styles/theme-arbitration.css` (定义了 CSS Variables 和 Element Plus 覆盖样式)

## 5. 运行指南
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

## 6. 下一步建议
- 当前演示版已覆盖全流程核心 UI。
- 后续可根据需要添加更多交互细节（如“主任路径决策”中的生成名单算法模拟，或“结果汇总”的动态计算演示）。

---

## 7. 本轮对话新增结论（务必带入新对话）

### 7.0 覆盖区使用说明（给新对话的 AI）
- 新开对话后：请先阅读本文件，再阅读 `需求文档/第四章-仲裁庭.md` 与 `需求文档/新版仲裁组庭-PRD.md`。
- 仅需更新本文件时：只覆盖本章的 **7.6【本次对话覆盖区】**（从 BEGIN 到 END），其他章节不要改。

### 7.1 需求背景与目标
- 在工作台页面新增“合议庭分支树”，用于更直观理解流程并快速跳转到对应节点页面。
- 最终目标：分支树可替代时间轴导航；但现阶段先不替换、不删除、不覆盖现有时间轴。

### 7.2 合议庭定义与关键口径
- 合议庭 = 1 个首席 + 2 个边裁。
- “边裁一致/不一致”口径：同一方可能有多个当事人（如申请人 A/B/C），需要判断该方内部是否形成唯一一致选择。
  - 一致：A/B/C 均选择边裁甲 → 有效。
  - 不一致：A 选甲，B/C 选乙 → 无效，进入“推荐/审批”链路。

### 7.3 分支树产品形态（已确认）
- 范围：仅做“合议庭”分支（不做独任庭分支）。
- 交互：点击分支树节点后，通过 `setActiveNode(id)` 切换工作区；不新增路由页。
- 展示：分支树不展示节点状态，只用于理解与跳转。
- 权限：分支树全员可见，不做权限差异。
- 布局：左侧固定树（A 形态），现阶段不替换现有时间轴。
- 代码组织：分支树模块放在 `src/modules/` 下单独分模块开发。

### 7.4 页面需要同步改动（已确认）
- 顶部 Banner 的“三人仲裁庭”文案改为“合议庭”。
- `NodeSelection.vue` 新增第三张方式卡片：“委托边裁选择首席”，与其他两张同排显示（不换行）。

### 7.5 流程参考（辅助理解）
- 合议庭流程图（图1）：`需求文档/新合议庭流程.png`。
- 流程骨架参考：`需求文档/2026组庭.pdf`。

### 7.6 【本次对话覆盖区】（新开对话时：直接复制带走；下次更新：只覆盖本区块）
<!-- BEGIN:CONVERSATION_OVERWRITE -->
#### 7.6.1 对话约定（用于校验是否脱离上下文）
- AI 每次回答第一句话必须称呼用户为 Yela。
- 动手开发/改代码前，必须先确认方案范围，且只有在用户明确下达“可以开干/开始改/动手”等指令后才开始执行。

#### 7.6.2 本次对话核心结论（已确认）
- 分支树结构以 `2026组庭.pdf` 为骨架，同时结合 `新合议庭流程.png` 补充判断口径（边裁一致/不一致、限期共同选定等）。
- 分支树主干固定：合议庭（根）→组庭启动（秘书）→三种方式（首席+边裁都已选定 / 当事人委托边裁选择首席 / 当事人选择边裁）。
- “委托主任选定/委托主任指定”在分支树中点击后：跳转到 Node 7（主任选择指定路径），不等同于代码里 `id=4` 的披露与接受页面。
- “主任确认边裁”在分支树中点击后：跳转到 Node 7。
- “首席确认流程”的落点：跳转到 Node 11（主任最终指定）。
- 树上需要露出“退回”节点（在主任审核处显示可退回到边裁选择）。
- 树上不露出“推荐5人排序名单→当事人排序→系统汇总”这段链路（不展示 8/9/10 的子链条）。
- 分支树点击只做节点跳转，不自动切换全局角色；页面需统一展示“该页面视角（roleLabel）”口径。

#### 7.6.3 合议庭分支树（最终口径 vFinal）
- 合议庭（根）
  - 组庭启动（秘书）→ Node 1
  - 三种方式（一级分叉，顺序固定）
    - A 首席+边裁都已选定 → 审批链：Node 6（部门负责人审批）→ Node 6.5（分管委领导审批）→ Node 11（主任最终指定/确认）
    - B 当事人委托边裁选择首席
      - 当事人选择边裁 → Node 2
      - 判断：当事人选择边裁是否一致
        - 一致 → 主任审核（露出“退回”）
          - 主任审核 → Node 7
          - 退回 → Node 2
          - 确认边裁 → 通知边裁限期共同选定首席 → Node 3
            - 结果一致 → 首席确认 → Node 11
            - 结果不一致 → 首席审批链：Node 6 → Node 6.5 → Node 11
        - 不一致 → 边裁审批链：Node 6 → Node 6.5 → 主任确认边裁 Node 7 → 通知边裁限期共同选定首席 Node 3（后续同上）
    - C 当事人选择边裁
      - 当事人选择边裁 → Node 2
      - 当事人选择首席组成方式（三选一）
        - 委托边裁选定首席 → 复用方式 B 子流程
        - 双方当事人共同选定 → Node 3
        - 委托主任选定/指定 → Node 7

#### 7.6.4 未开始执行的开发项（等待用户“开干”指令）
- 新增左侧合议庭分支树模块并接入工作台布局（不替换现有时间轴）。
- 分支树节点点击跳转到对应 Node ID，并展示“该页面视角（roleLabel）”。
- 顶部 Banner 文案改为“合议庭”。
- `NodeSelection.vue` 增加“委托边裁选择首席”卡片并三卡同排。
<!-- END:CONVERSATION_OVERWRITE -->
